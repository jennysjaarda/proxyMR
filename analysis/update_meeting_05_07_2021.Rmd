---
title: "Update Meeting: 05-07-2021"
author: "jennysjaarda"
date: "2021-07-02"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
  toc: true
---


```{r setup, include = FALSE}

options(scipen=999)
source("code/settings.R")
library(targets)
library(dplyr)
library(DT)
library(knitr)

```

```{r, echo=FALSE,include = FALSE}
# You need this code to conduct the magic dependences attaching...
DT::datatable(matrix())
```


## Last week summary.

- Discussed PolyMR project with Jonathan. 
  - To start by writing introduction. 
  - Going through paper in-depth. 
  
## Results. 

- Univariate MR. 

```{r univar_mr, echo = FALSE}

household_MR_exhaustive_summary <- readRDS("household_MR_exhaustive_summary.rds")
traits_corr2_update <- readRDS("traits_corr2_update.rds")
traits_corr2_update <- traits_corr2_update[which(traits_corr2_update[["Neale_file_sex"]]=="both"),]

description_temp <- left_join(household_MR_exhaustive_summary, traits_corr2_update[, c("Neale_pheno_ID", "description")], by=c("exposure_ID"="Neale_pheno_ID")) %>%
  rename(exposure_description = description)

description <- left_join(description_temp, traits_corr2_update[, c("Neale_pheno_ID", "description")], by=c("outcome_ID"="Neale_pheno_ID")) %>%
  rename(outcome_description = description)


household_MR_exhaustive_summary <- description %>% mutate(same_traits = case_when(exposure_ID == outcome_ID ~ TRUE, 
                                                                   TRUE ~ FALSE)) %>% dplyr::select(-exposure, -outcome) %>%
  dplyr::select(-Egger_summary, -Egger_pval, -Egger_int_pval, -Het_IVW_Qpval, -N_snps_sensitivity, -`IVW/Wald_summary_sensitivity`, -`IVW/Wald_pval_sensitivity`, -outcome_sex)


DT::datatable(household_MR_exhaustive_summary, width = "100%")

```

- Number of BF-significant results: 
```{r BF_sig, echo = FALSE}

BF_sig <- household_MR_exhaustive_summary %>% rename(IVW_Wald_pval= `IVW/Wald_pval`) %>% 
  mutate_at("IVW_Wald_pval", as.numeric) %>% filter(IVW_Wald_pval < 0.05/dim(.)[1]) 

dim(BF_sig)

```

- Significant results not in the same trait

```{r non_same_traits, echo = FALSE}

diff_traits <- BF_sig %>% filter(same_traits==FALSE)
DT::datatable(diff_traits, width = "100%")

```
## Questions. 

- Expand list of outcomes? 
  - Initially only performed MR with a single trait (i.e. trait_partner ~ trait_index). 
  - Now that we are expanding to two traits in the analysis we could be less stringent with our trait selection.
  - Traits were filtered as follows: 
    1. UKBB phenotypes in SGG database.
    2. Link with Neale summary stats and include only phenotypes which have been processed in both male, female and joint GWAS. 
    3. Evidence of correlation among couples. 
    4. &gt;5 IVs at GW significance. 
    5. No evidence of sex heterogeneity among valid IVs. 
  - Could add more phenotpyes as outcomes


## Next steps. 

- 
