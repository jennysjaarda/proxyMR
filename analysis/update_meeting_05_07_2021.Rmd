---
title: "Update Meeting: 05-07-2021"
author: "Jenny Sjaarda"
date: "2021-07-02"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
  toc: true
---


```{r setup, include = FALSE}

options(scipen=999)
source("code/settings.R")
library(targets)
library(dplyr)
library(DT)
library(knitr)

```

```{r load_targets, include = FALSE, eval = ifelse(Sys.info()["sysname"]=="Linux", TRUE, FALSE)}

tar_load(household_MR_summary)


```


# Last week summary.

- Discussed PolyMR project with Jonathan. 
  - To start by writing introduction. 
  - Going through paper in-depth. 
- Next step: run MR between all traits within couples (previously had only looked at single trait at a time).

```{r single_trait_MR, echo = FALSE}
library(knitr)
knitr::include_graphics("assets/single_trait_MR.png", error = FALSE)
```

# Results. 

Ran MR between all pairs of traits within couples. Number of tests = $j^2 * 2$, where $j$ is the number of traits. MR models were run in each sex sepeartely (male to female and female to male), which is why we multiply by 2. 

```{r two_trait_MR_fig, echo = FALSE}
library(knitr)
knitr::include_graphics("assets/two_trait_model.png", error = FALSE)
```

The results significant after multiple hypothesis testing can be seen below. 

```{r two_trait_MR_results, echo = FALSE}

household_MR_summary.DT <- household_MR_summary %>% dplyr::select(exposure_description, outcome_description, same_trait, exposure_sex, IVW_beta, IVW_pval, IVW_meta_beta, IVW_meta_pval)

num_tests <- dim(household_MR_summary.DT)[1]/2
household_MR_summary.DT.BF <- household_MR_summary.DT %>% filter(IVW_pval < 0.05/num_tests) 

DT::datatable(household_MR_summary.DT.BF, width = "100%") %>% formatRound(columns=c('IVW_beta', 'IVW_pval', 'IVW_meta_beta', 'IVW_meta_pval'), digits = 3)

```

The total number of tests = `r num_tests`, the number significant after adjusting for BF correction = `r dim(household_MR_summary.DT.BF)[1]`.

# Questions. 

- Expand list of outcomes? 
  - Initially only performed MR with a single trait (i.e. trait_partner ~ trait_index). 
  - Now that we are expanding to two traits in the analysis we could be less stringent with our trait selection.
  - Traits were filtered as follows: 
    1. UKBB phenotypes in SGG database.
    2. Link with Neale summary stats and include only phenotypes which have been processed in both male, female and joint GWAS. 
    3. Evidence of correlation among couples. 
    4. &gt;5 IVs at GW significance. 
    5. No evidence of sex heterogeneity among valid IVs. 
  - Could add more phenotpyes as outcomes?

# Next steps. 

- Calculate MR in same person to finish all analyses in diagram above. 

